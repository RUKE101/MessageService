# MessageService 

Микросервис для создания и чтения сообщений в real time.

Основной маршрут для приема сообщений — это /chat. Метод с аннотацией @MessageMapping("/chat") означает, что при публикации сообщения на этот путь в STOMP-сообщении будет вызван метод handleMessage.

## Как работает:
1. Клиент, подключаясь к WebSocket и используя STOMP-протокол, отправляет сообщение по маршруту /app/chat (по умолчанию 
префикс "/app" добавляется сервером, если настроена брокерная конфигурация).

2. Метод handleMessage получает объект MessageEntity и headers (где, например, можно получить JWT из сессии), проверяет 
валидность JWT, дополняет сообщение отправителем и временной меткой, сохраняет через сервис и отправляет получателю это сообщение по индивидуальному маршруту /user/{recipient}/queue/messages.

3. Отправка сообщения целевому пользователю внутри WebSocket происходит через simpMessagingTemplate.convertAndSendToUser(...), 
что соответствует индивидуальному пути типа /user/{username}/queue/messages.